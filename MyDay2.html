<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>MyDay</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2563eb">
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --primary: #2563eb; }
    body { touch-action: manipulation; }
  </style>
</head>

<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen">
  <div id="root" class="max-w-md mx-auto p-4"></div>

  <script type="text/babel">
    const STORAGE_KEY = "myday_mobile_v1";
    const defaultData = { tasks: [], notes: [], settings: { lang: "bn", primary: "#2563eb" } };
    const STR = {
      bn: { appTitle: "MyDay", add: "যোগ করো", delete: "ডিলিট", done: "সম্পন্ন", taskPlaceholder: "নতুন কাজ...", notes: "নোটস", customTheme: "থিম কালার", lang: "ভাষা" },
      en: { appTitle: "MyDay", add: "Add", delete: "Delete", done: "Done", taskPlaceholder: "New Task...", notes: "Notes", customTheme: "Theme Color", lang: "Language" }
    };

    const useLocal = (key, initial) => {
      const [state, set] = React.useState(() => JSON.parse(localStorage.getItem(key) || JSON.stringify(initial)));
      React.useEffect(() => localStorage.setItem(key, JSON.stringify(state)), [state]);
      return [state, set];
    };

    function MyDay() {
      const [data, setData] = useLocal(STORAGE_KEY, defaultData);
      const [task, setTask] = React.useState("");
      const t = (k) => STR[data.settings.lang][k];

      React.useEffect(() => {
        document.documentElement.style.setProperty("--primary", data.settings.primary);
      }, [data.settings.primary]);

      const addTask = () => {
        if (!task.trim()) return;
        setData({ ...data, tasks: [...data.tasks, { id: Date.now(), text: task, done: false }] });
        setTask("");
      };
      const toggle = (id) => setData({ ...data, tasks: data.tasks.map(t => t.id === id ? { ...t, done: !t.done } : t) });
      const del = (id) => setData({ ...data, tasks: data.tasks.filter(t => t.id !== id) });

      return (
        <div>
          <h1 className="text-2xl font-bold text-center mb-4">{t("appTitle")}</h1>

          <div className="flex gap-2 mb-4">
            <input value={task} onChange={(e)=>setTask(e.target.value)} placeholder={t("taskPlaceholder")}
              className="flex-1 border px-3 py-2 rounded bg-gray-50 dark:bg-gray-800"/>
            <button onClick={addTask} style={{background:"var(--primary)"}} className="text-white px-4 py-2 rounded">{t("add")}</button>
          </div>

          {data.tasks.map(x => (
            <div key={x.id} className="flex justify-between bg-white dark:bg-gray-800 p-2 rounded mb-2">
              <div>
                <input type="checkbox" checked={x.done} onChange={()=>toggle(x.id)} className="mr-2"/>
                <span className={x.done?"line-through text-gray-500":""}>{x.text}</span>
              </div>
              <button onClick={()=>del(x.id)} className="text-xs border px-2 rounded">{t("delete")}</button>
            </div>
          ))}

          <div className="mt-6 bg-white dark:bg-gray-800 p-4 rounded">
            <h3 className="font-semibold mb-2">{t("customTheme")}</h3>
            <input type="color" value={data.settings.primary}
              onChange={(e)=>setData({...data, settings:{...data.settings, primary:e.target.value}})} className="w-full h-10 mb-3"/>

            <h3 className="font-semibold mb-2">{t("lang")}</h3>
            <select value={data.settings.lang}
              onChange={(e)=>setData({...data, settings:{...data.settings, lang:e.target.value}})}
              className="border w-full px-2 py-1">
              <option value="bn">বাংলা</option>
              <option value="en">English</option>
            </select>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<MyDay />);
  </script>

  <script>
    // ✅ PWA install (offline support)
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js');
      });
    }
  </script>
</body>
</html>
